@model consultancysolution.Models.AccountDto

<div id="account" class="tab-pane" style="">
    <div class="admission-container">
        <partial name="_AdmissionInfo" model="Model.Admission" />
    </div>
    <div class="coursePayment-ontainer">
        <partial name="_CoursePaymentInfo" model="Model.CoursePayments" />
    </div>
</div>
<script>
    const studentId = $('#StudentID').val();
    
    //save admission fee
    function saveAdmissionFee(url){
        const admissionFee = parseFloat($("#admissionFee").text()) || 0;
        const discount = parseFloat($("#admissionFeeDiscount").val()) || 0;
        const modifiedFee = parseFloat($("#modifiedAdmissionFee").text()) || 0;
        const paid = parseFloat($("#paidAdmissionAmount").val()) || 0;
        const due = parseFloat($("#dueAdmissionAmount").text()) || 0;

        const payload = {
                AdmissionFee: admissionFee,
                Discount: discount,
                ModifiedAdmissionFee: modifiedFee,
                Paid: paid,
                Due: due
        };

        $.ajax({
            url: url,
            type: 'POST',
            data: JSON.stringify(payload),
            contentType: 'application/json',
            success: function (response) {
                alert("Admission Fee Saved");
                $('#admission-container').html(response);
            },
            error: function () {
                alert("Error saving admission fee");
            }
        });
    }
    $("#saveAdmissionFee, #updateAdmissionFee").click(function () {
        saveAdmissionFee(`/Students/SaveAdmissionFee?studentId=${studentId}`);
    });
    
    //save course payments
    function submitCoursePayments(url){
        const coursePayments = [];
        $("#coursePaymentTable tbody tr").each(function () {
            const row = $(this);
            const courseId = row.data("course-id");
            const price = parseFloat(row.find("td:nth-child(2)").text()) || 0;
            const paid = parseFloat(row.find(".paidAmount").val()) || 0;
            const due = Math.max(0, price - paid);

            // Update the UI values
            row.find(".dueAmount").text(due.toFixed(2));

            coursePayments.push({
                CourseId: courseId,
                Price: price,
                PaidAmount: paid,
                DueAmount: due
            });
        });
        $.ajax({
            url: url,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(coursePayments),
            success: function (response) {
                $('#coursePayment-container').html(response);
                alert("Course Payments Saved");
            },
            error: function () {
                alert("Error saving course payments");
            }
        });
    }
    $('#saveCoursePayments, #updateCoursePayments').click(function () {
        const saveUrl = `/Students/SaveCoursePayments?studentId=${studentId}`;
        submitCoursePayments(saveUrl);
    })
</script>
